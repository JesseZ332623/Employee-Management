<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<title>Employee Pagination Query</title>
	</head>

	<style>
		/* GitHub Dark Dimmed 主题风格 */
		:root {
			--bg-color: #22272e;
			--text-color: #adbac7;
			--link-color: #539bf5;
			--button-bg: #373e47;
			--button-border: #444c56;
			--button-hover: #444c56;
			--input-bg: #2d333b;
			--input-border: #444c56;
		}

		body {
			background-color: var(--bg-color);
			color: var(--text-color);
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
			line-height: 1.5;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
		}

		h1 {
			color: #cdd9e5;
			border-bottom: 1px solid #444c56;
			padding-bottom: 0.3em;
			font-size: 2em;
		}

		#employee_info_list {
			margin: 20px 0;
			padding-left: 25px;
		}

		#employee_info_list a {
			color: var(--link-color);
			text-decoration: none;
		}

		#employee_info_list a:hover {
			text-decoration: underline;
		}

		button {
			background-color: var(--button-bg);
			border: 1px solid var(--button-border);
			color: var(--text-color);
			padding: 5px 16px;
			border-radius: 6px;
			cursor: pointer;
			transition: background-color 0.2s;
			margin: 5px 3px;
		}

		button:hover {
			background-color: var(--button-hover);
		}

		#page_to_go {
			background-color: var(--input-bg);
			border: 1px solid var(--input-border);
			color: var(--text-color);
			padding: 5px 12px;
			border-radius: 6px;
			width: 120px;
			margin-left: 10px;
		}

		#page_to_go:focus {
			outline: none;
			box-shadow: 0 0 0 3px rgba(65, 132, 228, 0.3);
		}

		#page_catalogue {
			color: #768390;
			font-size: 0.9em;
			margin: 15px 0;
		}

		/* 分页控制容器 */
		body > button:not([onclick="jumpToSpecificPage"]) {
			margin-right: 8px;
		}

		/* 输入框组布局 */
		input + button {
			vertical-align: baseline;
			margin-left: 8px;
		}

		/* 响应式设计 */
		@media (max-width: 600px) {
			body {
				padding: 15px;
			}
			
			button {
				padding: 6px 12px;
				margin: 3px;
			}
			
			#page_to_go {
				width: 100%;
				margin: 10px 0;
			}
		}

		/* 新增动画相关CSS */
    @keyframes cardEntrance {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .employee-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 1.2rem;
        margin: 0.8rem 0;
        transition: all 0.25s ease;
        animation: cardEntrance 0.6s ease-out forwards;
        opacity: 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }

    .employee-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.24);
        border-color: var(--link-color);
    }

    .employee-card:nth-child(even) {
        animation-delay: 0.1s;
    }

    .employee-card a {
        display: grid;
        grid-template-columns: 50px 1fr;
        gap: 1.5rem;
        align-items: center;
        text-decoration: none!important;
    }

    .employee-id {
        background: var(--button-bg);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--link-color);
        transition: transform 0.3s ease;
    }

    .employee-info {
        border-left: 2px solid var(--input-border);
        padding-left: 1rem;
    }

    /* 新增颜色变量 */
    :root {
        --card-bg: #2d333b;
        --card-border: #444c56;
    }

    /* 优化原有样式 */
    #employee_info_list {
        list-style: none;
        padding-left: 0;
    }

    button {
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }

    button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.3s ease, height 0.3s ease;
    }

    button:active::after {
        width: 150px;
        height: 150px;
    }

    /* 加载动画 */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        display: none;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease-out;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #444c56;
        border-top-color: #539bf5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* 响应式优化 */
    @media (max-width: 600px) {
        .employee-card a {
            grid-template-columns: 1fr;
        }
        
        .employee-id {
            margin-bottom: 1rem;
        }
    }
</style>

	<body>
		<h1>Employee Pagination Query</h1>

		<div>
			<ul id="employee_info_list">
				<!-- <li><a href=""></a></li> -->
			</ul>
		</div>

		<div>
			<button type="button" onclick="goToPreviousPage()">Previous Page</button>
			<button type="button" onclick="goToNextPage()">Next Page</button>
			<button type="button" onclick="goToFirstPage()">To First Page</button>
			<button type="button" onclick="goToLastPage()">To Last Page</button>

			<input id="page_to_go" type="text" placeholder="Which page to go?">
			<button type="button" onclick="jumpToSpecificPage()">GO</button>

			<p id="page_catalogue"></p>
		</div>

		<div>
			<p>
				<span>Toltal Amount </span>
				<strong th:text="${EmployeeAmount} + ' '"></strong>
				<span>employees.</span>
			</p>

			<p th:text="${EmployeeAmount}" style="display:none" id="employee_amount"></p>
		</div>
	</body>
	<script>
		// 常量定义
		const ONE_PAGINATION_COUNT = 20; // 每页数据量
		const TOTAL_EMPLOYEE_AMOUNT = Number.parseInt(
			document.getElementById('employee_amount').textContent
		);
		const TOTAL_PAGES = Math.ceil(TOTAL_EMPLOYEE_AMOUNT / ONE_PAGINATION_COUNT);

		// 状态变量
		let CURRENT_OFFSET = 0; // 当前偏移量（替代原 INIT_OFFSET）

		// 初始化加载第一页
		doEmployeePaginationQuery();

		//======================= 核心分页逻辑 =======================//
		async function doEmployeePaginationQuery() 
		{
			clearElement('employee_info_list'); // 清空列表

			try 
			{
				// 1. 发起 API 请求
				const response = await fetch(
					`/api/employee/range_info/${ONE_PAGINATION_COUNT}_${CURRENT_OFFSET}`
				);

				// 2. 错误处理
				if (!response.ok) 
				{
					const error = await response.text();
					throw new Error(`HTTP ${response.status}: ${error}`);
				}

				// 3. 解析并验证数据
				const employees = await response.json();
				const listElement = document.getElementById('employee_info_list');

				for (const employee of employees) 
				{
					if (!validateEmployeeData(employee)) 
					{
						console.warn("Invalid employee data:", employee);
						return;
					}

					listElement.insertAdjacentHTML(
						'beforeend',
						`<li>
							<a href="/employee/query/${employee.employeeId}">
								Profile of employee: 
								[${employee.employeeId}] ${employee.firstName}-${employee.lastName}
							</a>
						</li>`
					);
				}

				// 4. 更新页码显示
				updatePageIndicator();

			} catch (error) {
				handleFetchError(error);
			}
		}

		//======================= 分页操作函数 =======================//
		function goToPreviousPage() 
		{
			const newOffset = CURRENT_OFFSET - ONE_PAGINATION_COUNT;

			if (updateOffset(newOffset)) {
				doEmployeePaginationQuery();
			}
		}

		function goToNextPage() 
		{
			const newOffset = CURRENT_OFFSET + ONE_PAGINATION_COUNT;

			if (updateOffset(newOffset)) {
				doEmployeePaginationQuery();
			}
		}

		function goToFirstPage() 
		{
			if (updateOffset(0)) {
				doEmployeePaginationQuery();
			}
		}

		function goToLastPage() 
		{
			if (updateOffset(TOTAL_EMPLOYEE_AMOUNT - ONE_PAGINATION_COUNT)) {
				doEmployeePaginationQuery();
			}
		}

		function jumpToSpecificPage() 
		{
			const input = document.getElementById('page_to_go').value.trim();

			// 输入验证
			if (!/^\d+$/.test(input)) {
				alert("请输入有效整数页码！");
				return;
			}

			const page = Number.parseInt(input);
			if (page < 1 || page > TOTAL_PAGES) {
				alert(`页码范围需在 1-${TOTAL_PAGES} 之间`);
				return;
			}

			const newOffset = (page - 1) * ONE_PAGINATION_COUNT;
			if (updateOffset(newOffset)) {
				document.getElementById('page_to_go').value = ""; // 清空输入框
				doEmployeePaginationQuery();
			}
		}

		//======================= 工具函数 =======================//
		function sleep(milliseconds) 
		{
			const date = Date.now();
			let currentDate = null;

			do {
				currentDate = Date.now();
			} while (currentDate - date < milliseconds);
		}


		function updateOffset(newOffset) {
			// 边界检查
			if (newOffset < 0) {
				alert("已经是第一页！");
				return false;
			}

			if (newOffset >= TOTAL_EMPLOYEE_AMOUNT) {
				alert("已经是最后一页！");
				return false;
			}

			CURRENT_OFFSET = newOffset;
			console.log(`Offset updated to: ${CURRENT_OFFSET}`);
			return true;
		}

		function updatePageIndicator() 
		{
			const currentPage = Math.floor(CURRENT_OFFSET / ONE_PAGINATION_COUNT) + 1;
			document.getElementById('page_catalogue').textContent 
				= `Curent Page: ${currentPage} / ${TOTAL_PAGES}`;
		}

		function validateEmployeeData(emp) 
		{
			return  emp?.employeeId 	   &&
					emp?.firstName?.trim() &&
					emp?.lastName?.trim();
		}

		function handleFetchError(error) 
		{
			console.error("请求失败:", error);
			alert(`数据加载失败: ${error.message}`);
		}

		function clearElement(id) 
		{
			document.getElementById(id).innerHTML = '';
		}

		//======================= 事件绑定 =======================//
		document.querySelectorAll('button').forEach(btn => {
			btn.addEventListener('click', function (e) {
				e.target.blur(); // 移除点击后的焦点样式
			});
		});
	</script>
</html>