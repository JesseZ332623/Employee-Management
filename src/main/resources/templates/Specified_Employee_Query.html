<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>Employee Profile</title>
		
		<link rel="stylesheet" th:href="@{/css/Specified_Employee_Query_Style.css}" />
	</head>

	<body>
		<h1>Employee Profile</h1>

		<div id="employee_info">
			<!-- 基本信息区块 -->
			<div id="basic_info">
				<section>
					<h2>Basic Information</h2>
					<p> ID:        <span th:text="${EmployeeInfo.employeeId}" id="employee_id"></span></p>
					<p> Name:      <span th:text="${EmployeeInfo.firstName} + '-' + ${EmployeeInfo.lastName}" id="employee_name"><span></p>
					<p>	Gender:    <span th:text="${EmployeeInfo.gender == 'M'} ? '♂️ Male' : '♀️ Female'" id="employee_gender"></span></p>
					<p>	Born Date: <time th:text="${EmployeeInfo.bornDate}" id="employee_born_date"></time></p>
					<p>	Hire Date: <time th:text="${EmployeeInfo.hireDate}" id="employee_hire_date"></time></p>
				</section>
			</div>

			<!-- 职业信息区块 -->
			<div id="major_info">
				<section>
					<h2>Career</h2>

					<article>
						<h3>Titles</h3>
						<ol id="titles_list" th:each="title : ${EmployeeInfo.titles}">
							<li th:text="${title}"></li>
						</ol>
					</article>

					<article>
						<h3>Department Timeline</h3>
						<table>
							<thead>
								<tr>
									<th>Department</th>
									<th>From Date</th>
									<th>To Date</th>
								</tr>
							</thead>
							<tbody id="department_timeline">
								<tr th:each="department, iter : ${EmployeeInfo.departments}">
									<td><span th:text="${department}"></span></td>
									<td><time th:text="${EmployeeInfo.fromDate[iter.index]}"></time></td>
									<td><time th:text="${EmployeeInfo.toDate[iter.index]}"></time></td>
								</tr>
							</tbody>
						</table>
					</article>
				</section>
			</div>

			<!-- 薪资历史区块 -->
			<div id="salary_history">
				<span id="salary_history_size" style="display: none;"
					  th:text="${#maps.size(EmployeeInfo.salaries)}"></span>
				<section>
					<h2>Salary History</h2>
					<table style="display: none;">
						<thead>
							<tr>
								<th>Duration</th>
								<th>Salary</th>
							</tr>
						</thead>
						<tbody id="salary_history_data">
							<tr th:each="entry, iter : ${EmployeeInfo.salaries}">
								<td>
									<time th:id="'salary_time_' + ${iter.index}" 
									      th:text="${entry.key}"></time>
								</td>
								<td>
									<strong th:text="'$' + ${entry.value}"
											th:id="'salary_val_' + ${iter.index}">
									</strong>
								</td>
							</tr>
						</tbody>
					</table>
					<div id="salary_charts" style="width: 100%; height:500px;">

					</div>
				</section>
			</div>
		</div>
	</body>

	<script th:src="@{/js/echarts.js}"></script>
	<script type="text/javascript">

		renderSalaryCharts();
	
		function renderSalaryCharts()
		{
			// 员工姓名
			var employeeName 
				= document.getElementById('employee_name').textContent;

			// 工资历史 map 的长度
			let historySize 
					= Number.parseInt(
						document.getElementById('salary_history_size').textContent
					);
			
			const durationSet = new Set(); // 工资时间段集合
			const salarySet   = new Set(); // 工资数值集合

			for (var index = 0; index < historySize; ++index)
			{
				durationSet.add(
					document.getElementById(`salary_time_${index}`).textContent
				);

				salarySet.add(
					Number.parseInt(
						document.getElementById(`salary_val_${index}`)
						        .textContent.substring(1)
					)
				);
			}


			var salaryChart = echarts.init(
				document.getElementById('salary_charts')
			);

			// 指定图表的配置项和数据
			option = {
				backgroundColor: '#0d1117',
				title: {
					text: `Salary history of [${employeeName}]`,
					textStyle: {
						color: '#ffffff',
						fontSize: 20
					},
					top: '2%',            // 增加顶部间距
            		left: 'center'
				},
				tooltip: {
					backgroundColor: '#161b22',
					borderColor: '#30363d',
					textStyle: {
						color: '#c9d1d9'
					}
				},
				legend: {
					textStyle: {
						color: '#8b949e'
					},
					top: '12%',           // 下移图例位置
            		itemGap: 25         // 增加图例项间距
				},
				grid: {                 // 新增grid配置控制绘图区域
					top: '20%',
					bottom: '15%',
					containLabel: true
				},
				xAxis: {
					show: false,
					type: 'category',
					axisLine: {
						lineStyle: {
							color: '#30363d',
						}
					},
					axisLabel: {
						color: '#8b949e',
						fontSize: 12,     // 缩小字号
						top: '12%'
					},
					data: Array.from(durationSet)
				},
				yAxis: {
					type: 'value',
					axisLine: {
						lineStyle: {
							color: '#30363d'
						}
					},
					axisLabel: {
						color: '#8b949e',
						formatter: '${value}'
					},
					splitLine: {
						lineStyle: {
							color: '#21262d'
						}
					}
				},
				series: [{
					name: 'Salary',
					type: 'line',
					smooth: true,
					symbol: 'circle',
					symbolSize: 8,
					lineStyle: {
						color: '#58a6ff',
						width: 2
					},
					itemStyle: {
						color: '#edede9',
						borderColor: '#0d1117',
						borderWidth: 2
					},
					areaStyle: {
						color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
							offset: 0,
							color: '#1f6feb66'
						}, {
							offset: 1,
							color: '#1f6feb00'
						}])
					},
					data: Array.from(salarySet)
				}]
			};

			salaryChart.setOption(option);
			salaryChart.resize();

			window.addEventListener(
				'resize', 
				function() { salaryChart.resize(); }
			);
		}
	</script>
</html>